<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>åˆ©ç”¨è€…æƒ…å ± | Village ã²ã‚ã°</title>

    <style>
      :root {
        --bg: #f6f7fb;
        --card: #ffffff;
        --text: #1f2937;
        --muted: #6b7280;
        --line: #e5e7eb;
        --shadow: 0 10px 24px rgba(0, 0, 0, 0.08);
        --shadow-sm: 0 6px 14px rgba(0, 0, 0, 0.08);
        --radius: 16px;
        --radius-lg: 20px;

        --accent: #2563eb;
        --accent-weak: #e8f0ff;
        --chip-bg: #f3f4f6;
      }

      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
        background: var(--bg);
        color: var(--text);
      }

      a { color: inherit; text-decoration: none; }
      a:hover { text-decoration: underline; }

      .container {
        width: min(1000px, calc(100% - 32px));
        margin: 18px auto 60px;
      }

      .topbar {
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: rgba(255,255,255,0.7);
        border: 1px solid var(--line);
        border-radius: var(--radius-lg);
        padding: 14px 16px;
        box-shadow: var(--shadow-sm);
        backdrop-filter: blur(6px);
      }

      .backlink {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        width: fit-content;
        padding: 8px 10px;
        border-radius: 999px;
        background: var(--card);
        border: 1px solid var(--line);
      }

      .title {
        display: grid;
        gap: 4px;
      }
      .title h1 {
        margin: 0;
        font-size: 20px;
        letter-spacing: 0.02em;
      }
      .title p {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
      }

      .controls {
        margin-top: 14px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .search {
        display: flex;
        gap: 10px;
        align-items: center;
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: 999px;
        padding: 10px 12px;
        box-shadow: var(--shadow-sm);
      }
      .search input {
        border: none;
        outline: none;
        width: 100%;
        font-size: 14px;
        background: transparent;
        color: var(--text);
      }
      .hint {
        font-size: 12px;
        color: var(--muted);
        margin: 2px 2px 0;
      }

      .grid {
        margin-top: 14px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }

      @media (min-width: 820px) {
        .grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius-lg);
        padding: 14px 14px 12px;
        box-shadow: var(--shadow);
        cursor: pointer;
        transition: transform 0.08s ease, box-shadow 0.08s ease;
        position: relative;
        overflow: hidden;
      }
      .card:hover { transform: translateY(-1px); }
      .card:active { transform: translateY(0px); }

      .card .name-row {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 10px;
      }

      .card .name {
        margin: 0;
        font-size: 16px;
        font-weight: 700;
      }

      .badge {
        font-size: 12px;
        color: #1d4ed8;
        background: var(--accent-weak);
        border: 1px solid #dbe7ff;
        padding: 5px 9px;
        border-radius: 999px;
        white-space: nowrap;
      }

      .meta {
        margin-top: 8px;
        display: grid;
        gap: 8px;
      }

      .row {
        display: grid;
        gap: 4px;
      }
      .label {
        font-size: 11px;
        color: var(--muted);
      }
      .value {
        font-size: 13px;
        color: var(--text);
        line-height: 1.35;
      }

      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .chip {
        font-size: 12px;
        padding: 6px 10px;
        background: var(--chip-bg);
        border: 1px solid var(--line);
        border-radius: 999px;
      }

      .empty {
        margin-top: 14px;
        padding: 14px;
        border-radius: var(--radius-lg);
        border: 1px dashed #cbd5e1;
        color: var(--muted);
        background: rgba(255,255,255,0.7);
      }

      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.45);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 18px;
        z-index: 50;
      }
      .modal-backdrop.show { display: flex; }

      .modal {
        width: min(720px, 100%);
        background: var(--card);
        border-radius: 22px;
        box-shadow: var(--shadow);
        border: 1px solid rgba(255,255,255,0.35);
        overflow: hidden;
      }

      .modal-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 12px;
        padding: 16px 16px 12px;
        border-bottom: 1px solid var(--line);
        background: linear-gradient(180deg, rgba(37,99,235,0.06), rgba(255,255,255,0));
      }

      .modal-title {
        display: grid;
        gap: 4px;
      }
      .modal-title h2 {
        margin: 0;
        font-size: 18px;
      }
      .modal-title p {
        margin: 0;
        color: var(--muted);
        font-size: 12px;
      }

      .close-btn {
        border: 1px solid var(--line);
        background: #fff;
        padding: 8px 10px;
        border-radius: 999px;
        cursor: pointer;
      }

      .modal-body {
        padding: 14px 16px 16px;
        display: grid;
        gap: 12px;
      }

      .detail-grid {
        display: grid;
        gap: 10px;
      }
      @media (min-width: 680px) {
        .detail-grid {
          grid-template-columns: 1fr 1fr;
          gap: 12px;
        }
      }

      .detail-box {
        border: 1px solid var(--line);
        border-radius: var(--radius);
        padding: 12px;
        background: rgba(246,247,251,0.6);
      }

      .detail-box .label { margin-bottom: 4px; }
      .detail-box .value { font-size: 14px; }

      .memo {
        white-space: pre-wrap;
      }

      .tech-note {
        margin-top: 18px;
        font-size: 12px;
        color: var(--muted);
      }
      .tech-note code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        font-size: 12px;
        background: #fff;
        border: 1px solid var(--line);
        padding: 2px 6px;
        border-radius: 8px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <header class="topbar">
        <a class="backlink" href="https://client-sche.web.app/" aria-label="ã²ã‚ã°ã«æˆ»ã‚‹">
          â† ã²ã‚ã°ã«æˆ»ã‚‹
        </a>

        <div class="title">
          <h1>åˆ©ç”¨è€…æƒ…å ±</h1>
          <p>åˆ©ç”¨è€…ã®åŸºæœ¬æƒ…å ±ã‚’ç¢ºèªã§ãã¾ã™</p>
        </div>
      </header>

      <section class="controls" aria-label="æ¤œç´¢">
        <div class="search">
          <span aria-hidden="true">ğŸ”</span>
          <input id="searchInput" type="search" placeholder="åˆ©ç”¨è€…å / ä½æ‰€ / æ”¯æ´å†…å®¹ã§æ¤œç´¢" />
        </div>
        <div class="hint">ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒé–‹ãã¾ã™ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºï¼‰ã€‚</div>
      </section>

      <main>
        <div id="list" class="grid" aria-label="åˆ©ç”¨è€…ä¸€è¦§"></div>
        <div id="empty" class="empty" style="display:none;">è©²å½“ã™ã‚‹åˆ©ç”¨è€…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>
      </main>

      <div class="tech-note">
        å°†æ¥ Supabase æ¥ç¶šã«ã™ã‚‹å ´åˆã¯ã€<code>loadClients()</code> å†…ã®ãƒ¢ãƒƒã‚¯é…åˆ—ã‚’
        <code>fetch</code> ã«ç½®æ›ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’åŒã˜å½¢ï¼ˆid, name, address, fullAddress, contact, services, memoï¼‰ã§è¿”ã™ã ã‘ã§ UI ã¯ç¶­æŒã§ãã¾ã™ã€‚
      </div>
    </div>

    <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">
            <h2 id="modalTitle">åˆ©ç”¨è€…è©³ç´°</h2>
            <p id="modalSub">åŸºæœ¬æƒ…å ±</p>
          </div>
          <button id="closeBtn" class="close-btn" type="button" aria-label="é–‰ã˜ã‚‹">é–‰ã˜ã‚‹</button>
        </div>
        <div class="modal-body">
          <div class="detail-grid">
            <div class="detail-box">
              <div class="label">åˆ©ç”¨è€…å</div>
              <div id="dName" class="value">-</div>
            </div>
            <div class="detail-box">
              <div class="label">é€£çµ¡å…ˆ</div>
              <div id="dContact" class="value">-</div>
            </div>
            <div class="detail-box" style="grid-column: 1 / -1;">
              <div class="label">ãƒ•ãƒ«ä½æ‰€</div>
              <div id="dFullAddress" class="value">-</div>
            </div>
            <div class="detail-box" style="grid-column: 1 / -1;">
              <div class="label">æ”¯æ´å†…å®¹</div>
              <div id="dServices" class="chips"></div>
            </div>
            <div class="detail-box" style="grid-column: 1 / -1;">
              <div class="label">ãƒ¡ãƒ¢</div>
              <div id="dMemo" class="value memo">-</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const mockClients = [
        {
          id: 1,
          name: "å±±ç”° å¤ªéƒ",
          address: "æ±äº¬éƒ½å¤§ç”°åŒº",
          fullAddress: "æ±äº¬éƒ½å¤§ç”°åŒºã€‡ã€‡ 1-2-3 ã€‡ã€‡ãƒãƒ³ã‚·ãƒ§ãƒ³ 101",
          contact: "03-0000-0000ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰",
          services: ["ç§»å‹•æ”¯æ´", "èº«ä½“ä»‹è­·"],
          memo: "åˆå‰ä¸­å¸Œæœ›\nç„é–¢å‰ã«æ®µå·®ã‚ã‚Š"
        },
        {
          id: 2,
          name: "ä½è—¤ èŠ±å­",
          address: "æ±äº¬éƒ½å“å·åŒº",
          fullAddress: "æ±äº¬éƒ½å“å·åŒºâ–³â–³ 4-5-6",
          contact: "090-0000-0000ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰",
          services: ["å®¶äº‹æ´åŠ©"],
          memo: "è²·ã„ç‰©æ”¯æ´ã¯é€±2å›\né™ã‹ãªå£°ã‹ã‘ãŒæœ›ã¾ã—ã„"
        },
        {
          id: 3,
          name: "éˆ´æœ¨ ä¸€éƒ",
          address: "æ±äº¬éƒ½å¤§ç”°åŒº",
          fullAddress: "æ±äº¬éƒ½å¤§ç”°åŒºâ–¡â–¡ 7-8-9",
          contact: "03-1111-2222ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰",
          services: ["é€šé™¢ä»‹åŠ©", "ç§»å‹•æ”¯æ´"],
          memo: "ç—…é™¢ã¯åˆå‰äºˆç´„ãŒå¤šã„"
        },
        {
          id: 4,
          name: "é«˜æ©‹ ç¾å’²",
          address: "æ±äº¬éƒ½ç›®é»’åŒº",
          fullAddress: "æ±äº¬éƒ½ç›®é»’åŒºâ—‡â—‡ 10-11-12",
          contact: "03-3333-4444ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰",
          services: ["èº«ä½“ä»‹è­·"],
          memo: "å…¥æµ´ä»‹åŠ©ã¯ä½“èª¿ç¢ºèªã‚’å„ªå…ˆ"
        }
      ];

      const state = {
        clients: [],
        filtered: [],
        selected: null
      };

      const $list = document.getElementById("list");
      const $empty = document.getElementById("empty");
      const $search = document.getElementById("searchInput");

      const $modalBackdrop = document.getElementById("modalBackdrop");
      const $closeBtn = document.getElementById("closeBtn");
      const $dName = document.getElementById("dName");
      const $dContact = document.getElementById("dContact");
      const $dFullAddress = document.getElementById("dFullAddress");
      const $dServices = document.getElementById("dServices");
      const $dMemo = document.getElementById("dMemo");
      const $modalTitle = document.getElementById("modalTitle");
      const $modalSub = document.getElementById("modalSub");

      function escapeHtml(str) {
        return String(str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      /**
       * ã€ã‚ã¨ã§ Supabase ã«ã¤ãªããªã‚‰ã“ã“ã‚’å¤‰ãˆã‚‹ã€‘
       * - ã„ã¾ï¼šmockClients ã‚’è¿”ã™
       * - å°†æ¥ï¼šSupabase REST / Edge Function ç­‰ã«ç½®æ›ã—ã¦åŒã˜å½¢ã®é…åˆ—ã‚’è¿”ã™
       */
      async function loadClients() {
        // å°†æ¥ä¾‹:
        // const res = await fetch("/api/clients");
        // const data = await res.json();
        // return data;
        return mockClients;
      }

      function renderList(items) {
        $list.innerHTML = "";

        if (!items.length) {
          $empty.style.display = "block";
          return;
        }
        $empty.style.display = "none";

        const frag = document.createDocumentFragment();

        items.forEach((c) => {
          const card = document.createElement("article");
          card.className = "card";
          card.tabIndex = 0;
          card.setAttribute("role", "button");
          card.setAttribute("aria-label", `${c.name} ã®è©³ç´°ã‚’é–‹ã`);

          const servicesPreview = (c.services || []).slice(0, 2);
          const moreCount = Math.max(0, (c.services || []).length - servicesPreview.length);

          card.innerHTML = `
            <div class="name-row">
              <h3 class="name">${escapeHtml(c.name)}</h3>
              <span class="badge">è©³ç´°</span>
            </div>

            <div class="meta">
              <div class="row">
                <div class="label">ä½æ‰€ï¼ˆå¸‚åŒºç”ºæ‘ãƒ¬ãƒ™ãƒ«ï¼‰</div>
                <div class="value">${escapeHtml(c.address || "-")}</div>
              </div>

              <div class="row">
                <div class="label">ä¸»ãªæ”¯æ´å†…å®¹</div>
                <div class="chips">
                  ${(servicesPreview || []).map(s => `<span class="chip">${escapeHtml(s)}</span>`).join("")}
                  ${moreCount ? `<span class="chip">+${moreCount}</span>` : ""}
                </div>
              </div>
            </div>
          `;

          const open = () => openModal(c.id);
          card.addEventListener("click", open);
          card.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              open();
            }
          });

          frag.appendChild(card);
        });

        $list.appendChild(frag);
      }

      function applyFilter(keyword) {
        const q = keyword.trim().toLowerCase();
        if (!q) return state.clients.slice();

        return state.clients.filter((c) => {
          const hay = [
            c.name,
            c.address,
            c.fullAddress,
            (c.services || []).join(" "),
            c.memo,
          ]
            .filter(Boolean)
            .join(" ")
            .toLowerCase();

          return hay.includes(q);
        });
      }

      function openModal(id) {
        const c = state.clients.find((x) => x.id === id);
        if (!c) return;

        state.selected = c;

        $modalTitle.textContent = c.name;
        $modalSub.textContent = "åˆ©ç”¨è€…ã®åŸºæœ¬æƒ…å ±";

        $dName.textContent = c.name || "-";
        $dContact.textContent = c.contact || "-";
        $dFullAddress.textContent = c.fullAddress || c.address || "-";

        $dServices.innerHTML = "";
        (c.services || []).forEach((s) => {
          const chip = document.createElement("span");
          chip.className = "chip";
          chip.textContent = s;
          $dServices.appendChild(chip);
        });
        if (!(c.services || []).length) {
          const chip = document.createElement("span");
          chip.className = "chip";
          chip.textContent = "-";
          $dServices.appendChild(chip);
        }

        $dMemo.textContent = c.memo || "-";

        $modalBackdrop.classList.add("show");
        document.body.style.overflow = "hidden";
        $closeBtn.focus();
      }

      function closeModal() {
        $modalBackdrop.classList.remove("show");
        document.body.style.overflow = "";
        state.selected = null;
      }

      function bindEvents() {
        $search.addEventListener("input", (e) => {
          state.filtered = applyFilter(e.target.value);
          renderList(state.filtered);
        });

        $closeBtn.addEventListener("click", closeModal);

        $modalBackdrop.addEventListener("click", (e) => {
          if (e.target === $modalBackdrop) closeModal();
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && $modalBackdrop.classList.contains("show")) {
            closeModal();
          }
        });
      }

      async function init() {
        bindEvents();
        state.clients = await loadClients();
        state.filtered = state.clients.slice();
        renderList(state.filtered);
      }

      init();
    </script>
  </body>
</html>
